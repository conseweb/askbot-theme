{%- if request.user.is_authenticated() -%}
    <a href="{{ request.user.get_absolute_url() }}">{{ request.user.username|escape }}</a> 
    <span class="user-info">
    {{ macros.inbox_link(request.user) }}
    {{ macros.moderation_items_link(request.user, moderation_items) }}
    {%-
        if settings.KARMA_MODE != 'hidden' and settings.BADGES_MODE != 'hidden' 
    -%}
        ({{ macros.user_long_score_and_badge_summary(
                                        user,
                                        badges_mode = settings.BADGES_MODE
            )
        }})
    {%- endif -%}
    </span>
    {% if settings.USE_ASKBOT_LOGIN_SYSTEM %}
         <a href="{{ settings.LOGOUT_URL }}?next={{ settings.LOGOUT_REDIRECT_URL }}">{% trans %}sign out{% endtrans %}</a>
    {% endif %}
{% elif settings.USE_ASKBOT_LOGIN_SYSTEM %}
    <script type="text/javascript">
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].replace(/^\s+|\s+$/g, '');
                // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
    <form style="display: inline;" action="{{ settings.LOGIN_URL }}" method="post">
        <input id="launchpad_csrf_token" type="hidden" name="csrfmiddlewaretoken" value="" />
        <script type="text/javascript">
            var csrfInput = document.getElementById('launchpad_csrf_token');
            csrfInput.setAttribute('value', getCookie('{{ settings.CSRF_COOKIE_NAME }}'));
        </script>
        <input type="hidden" name="login_provider_name" value="openid" />
        <input type="hidden" name="openid_login_token" value="https://login.launchpad.net/" />
        <input type="hidden" name="next" value="{{ request.path|clean_login_url|escape }}" />
        <button>{% trans %}Hi there! Please, sign in{% endtrans %}</button>
    </form>
{% endif %}
{% if request.user.is_authenticated() and request.user.is_administrator() %}
    <a class="settings" href="{% url site_settings %}">{% trans %}settings{% endtrans %}</a>
    <a class="widgets" href="{% url widgets %}">{% trans %}widgets{% endtrans %}</a>
{% endif %}
    <a class="help" href="{% url "help" %}" title="{% trans %}help{% endtrans %}">{% trans %}help{% endtrans %}</a>
